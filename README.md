# 🛒 淘宝用户行为分析与推荐系统 (User-Based CF)

> "因为不仅是你妈，我也觉得你缺条秋裤。" —— 基于用户的协同过滤算法

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue.svg)](https://www.python.org/)
[![Style](https://img.shields.io/badge/Style-SCI%20Journal-red.svg)](https://nature.com)
[![Coffee](https://img.shields.io/badge/Coffee-Consumed-brown.svg)]()

## 📖 这是一个什么项目？

简单来说，这是一个 **“偷窥”**（划掉）**分析** 淘宝用户行为，并试图以此掏空他们钱包的 Python 项目。

我们使用 **基于用户的协同过滤算法 (User-Based Collaborative Filtering)**，核心逻辑就是：
*   **你** 喜欢买 A、B、C。
*   **隔壁老王** 也喜欢买 A、B、C，而且他还买了 **D**。
*   **结论**：你应该也想买 **D**。（快买！不买不是人！）

本项目不仅实现了推荐算法，还附带了 **“看起来可以发 SCI 顶刊”** 的数据可视化。配色骚气，字体优雅，不仅能跑，还能发朋友圈装杯。

## ✨ 核心功能 (Features)

*   **🕵️‍♂️ 深度行为分析**：
    *   把用户的 `pv`、`fav`、`cart`、`buy` 行为翻译成人话（浏览、收藏、加购、购买）。
    *   给不同行为打分，建立“用户-商品”的感情连接矩阵。
*   **🤝 协同过滤算法**：
    *   使用 **余弦相似度** 计算用户之间的“基情”指数。
    *   利用 K-Nearest Neighbors (KNN) 找到你的灵魂伴侣（购物搭子）。
    *   生成 Top-N 推荐列表，精准打击用户痛点。
*   **🎨 SCI 级可视化**：
    *   **拒绝直男审美**：抛弃 matplotlib 默认配色，采用 Nature/Science 同款色盘。
    *   **中文无乱码**：内置核弹级字体修复方案，Windows 下也能优雅显示中文（再也不用看方块字了）。
    *   **图表丰富**：
        *   📊 **用户行为类型分布**：看看大家是只看不买的“白嫖党”，还是直接下单的“土豪”。
        *   📈 **24小时活跃度**：凌晨3点还在刷淘宝的，都是有故事的人。
        *   💰 **价格分布**：99% 的商品都在你买得起的范围内（大概）。
        *   🔥 **相似度热力图**：看清用户之间错综复杂的关系网。

## 🧠 算法建模详解 (Algorithm Modeling)

### 1. 基于用户的协同过滤 (User-Based CF)

本代码实现的核心思想是：**“你和谁像，就买谁买过的东西”**。它挖掘用户历史行为的相似性，找到目标用户的“邻居”，利用邻居的偏好进行预测推荐。

#### 1.0 算法流程图 (Algorithm Flowchart)

为了让你一眼看懂代码在干什么，我画了一张逻辑清晰的流程图。不要问我为什么画这么好，问就是专业。

![用户协同过滤算法流程图](流程图edraw/User_based.png)

#### 1.1 用户行为量化 (Implicit to Explicit Feedback)

原始数据包含浏览、收藏、加购、购买等隐式行为。为了构建评分矩阵，首先建立行为强度映射模型。

*   **代码位置**：`behavior_score` 字典
*   **建模公式**：
    设用户 $u$ 对物品 $i$ 的行为类型为 $b_{ui}$，则评分 $r_{ui}$ 定义为：
    $$
    r_{ui} = \sum w(b_{ui})
    $$
    其中权重 $w$ 映射如下：
    *   浏览 (pv) = 1
    *   收藏 (fav) = 2
    *   加购 (cart) = 3
    *   购买 (buy) = 4
*   **实现细节**：如果用户对同一商品有多次相同行为，在构建矩阵时采用 `sum` 聚合，即多次浏览权重会累加，体现更强的兴趣。

#### 1.2 构建用户-物品评分矩阵 (User-Item Matrix Construction)

将长表（Log Data）转换为宽表矩阵，这是协同过滤的基础数据结构。

*   **代码位置**：`build_user_item_matrix` 函数
*   **数学表示**：
    构建矩阵 $R_{m \times n}$，其中 $m$ 为用户数，$n$ 为物品数。
    $$
    R = \begin{bmatrix}
    r_{11} & r_{12} & \cdots & r_{1n} \\
    r_{21} & r_{22} & \cdots & r_{2n} \\
    \vdots & \vdots & \ddots & \vdots \\
    r_{m1} & r_{m2} & \cdots & r_{mn}
    \end{bmatrix}
    $$
    矩阵极其稀疏，未交互项填充为 $0$。

#### 1.3 用户相似度计算 (User Similarity Calculation)

寻找与目标用户兴趣相似的群体。本代码采用 **余弦相似度 (Cosine Similarity)**，它衡量的是用户向量在多维空间中方向的一致性，而非距离。

*   **代码位置**：`compute_user_similarity` 函数
*   **核心公式**：
    设用户 $u$ 和用户 $v$ 的评分向量分别为 $\vec{r}_u$ 和 $\vec{r}_v$，其相似度 $sim(u,v)$ 为：
    $$
    sim(u, v) = \cos(\theta) = \frac{\vec{r}_u \cdot \vec{r}_v}{\|\vec{r}_u\| \|\vec{r}_v\|} = \frac{\sum_{i \in I} r_{ui} r_{vi}}{\sqrt{\sum_{i \in I} r_{ui}^2} \sqrt{\sum_{i \in I} r_{vi}^2}}
    $$
    其中 $I$ 是所有物品的集合。代码直接调用 `sklearn.metrics.pairwise.cosine_similarity` 高效实现矩阵运算。

#### 1.4 评分预测与 Top-N 推荐 (Prediction & Generation)

基于相似邻居的偏好，预测目标用户对未交互物品的感兴趣程度。

*   **代码位置**：`generate_recommendations` 函数
*   **步骤详解**：
    1.  **邻居选择**：对于目标用户 $u$，在相似度矩阵中找到相似度最高的 $K$ 个用户，构成邻居集合 $N(u)$。
    2.  **加权预测**：利用邻居对物品 $i$ 的评分 $r_{vi}$，以相似度 $sim(u,v)$ 为权重进行加权平均。
    3.  **过滤已交互**：排除用户历史已经产生过行为的物品。
    4.  **Top-N 排序**：对预测评分降序排列，取前 $N$ 个作为最终推荐列表。

#### 1.5 可视化分析与结果展示 (Visualization & Results)

既然跑出了结果，当然要拿出来炫耀一下。以下是我们生成的分析图表：

**1. 用户行为类型分布**
看看大家是只看不买的“白嫖党”，还是直接下单的“土豪”。
![用户行为类型分布](User_png/用户行为类型分布.png)
*分析：从图中可以看出，浏览行为（pv）占据了绝大多数，这符合漏斗模型。真正转化为购买的比例较低，说明用户比较挑剔（或者比较穷）。*

**2. 24小时活跃度分布**
凌晨3点还在刷淘宝的，都是有故事的人。
![用户行为小时分布](User_png/用户行为小时分布.png)
*分析：用户活跃度在晚间达到高峰（约20:00-22:00），这是典型的“睡前刷手机”综合症。营销活动如果放在这个时间段，效果应该会炸裂。*

**3. 商品价格分布 (Top 99%)**
99% 的商品都在你买得起的范围内（大概）。
![商品价格分布](User_png/商品价格分布.png)
*分析：价格分布呈现明显的长尾效应，低价商品占据主导地位。毕竟大家都是普通人，几万块的东西看看就好。*

**4. 相似度热力图**
看清用户之间错综复杂的关系网。
![用户相似度热力图](User_png/用户相似度热力图.png)
*分析：热力图中颜色较深的区域代表用户兴趣高度重合。如果发现一片红，说明这一群人的品味出奇的一致。*

**5. 推荐结果示例 (CSV)**
这就是我们为用户精心挑选的“剁手清单”。以下是部分推荐结果预览：

| user_id | item_id | rank | score | item_name | item_category | brand | price |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 444056 | 3744636 | 1 | 0.7958 | 华为MatePad Pro... | 电子产品 | 华为 | 4415.07 |
| 444056 | 2734479 | 2 | 0.7074 | 格力微波炉P70... | 家用电器 | 格力 | 1624.95 |
| 576877 | 3111890 | 1 | 0.8850 | 欧派浴室柜 80cm... | 家居用品 | 欧派 | 2903.45 |
| 576877 | 8033659 | 2 | 0.7837 | 宜家爱克托沙发... | 家居用品 | 宜家 | 9036.23 |

*(注：完整结果请查看 `User_png/用户协同过滤推荐结果.csv`)*

### 2. 基于物品的协同过滤 (Item-Based CF)

*(🚧 施工中 / Under Construction...)*

核心思想是：**“喜欢这个商品的人，也喜欢那个商品”**（物以类聚）。
Item-Based CF 并非根据物品属性（如颜色、品牌）计算相似度，而是根据**用户的交互历史**来计算物品之间的相似度。

*   适用于：用户数量远远多于物品数量的场景（如亚马逊、Netflix）。
*   优势：物品间的相似度比较稳定，不需要频繁更新。

*(更多详情敬请期待...)*

## 🛠️ 快速开始 (Getting Started)

### 1. 环境准备

首先，你需要一台电脑（废话），并且安装了 Python。
然后，安装这些看起来很厉害的库：

```bash
pip install pandas numpy seaborn matplotlib scikit-learn
```

### 2. 数据准备

请确保你的目录下有 `data/UserBehavior.csv`。
如果没有……那你可能需要去阿里云天池偷一份，或者自己造一点假数据（不推荐，会被老师打）。

### 3. 一键运行

找到那个文件名最长的 Python 脚本，狠狠地运行它：

```bash
python "01基于用户的协同过滤算法.py"
```

### 4. 收获果实

程序运行结束后，请移步 `User_png` 文件夹：
*   你会看到一堆漂亮的图表，建议直接右键“设置为桌面壁纸”。
*   还会生成一个 `用户协同过滤推荐结果.csv`，里面就是我们精心计算的“剁手清单”。

## 🧩 算法评估 (Evaluation)

我们在训练集上跑了一下（因为懒得切分测试集），结果如下：

*   **Precision (准确率)**: `0.9600` —— 准得离谱，说明算法完全记住了用户的喜好。
*   **Recall (召回率)**: `0.4942` —— 推荐列表里有一半是你之前看过的，稳！
*   **Coverage (覆盖率)**: `1.0000` —— 没有任何一件商品被我们歧视，众生平等。

*(注：以上数据仅供参考，如有雷同，纯属代码写得好。)*

## 👨‍💻 作者 (Author)

**一个即将毕业、头发还算茂密的软件工程大四学生**

*   代码风格：严格遵守 PEP8（大概）。
*   注释风格：详细到像是在写小说，生怕你看不懂。
*   座右铭：代码可以跑不通，但图一定要好看。

## 📄 License

太麻烦了，不晓得咋个添加 —— 随便拿去用，记得给个 Star ⭐ 就行。如果不给 Star，祝你 Bug 连连，分号丢失。嘿嘿嘿，骗你的，我的心肝宝贝~~~
